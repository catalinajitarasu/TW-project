<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style-home-page.css">

    <title>Document</title>
</head>
<body>
    <div class="main">
        <div class="logo">
            <img src="FOSO.png" alt="Foso" >
        </div>
        <ul>
            <li> <a href="home-page.html">Home</a></li>
            <div class="dropdown">
                <div class="select">
                    <span class="selected">Choose format</span>
                    <div class="caret"></div>
                </div>
                <ul class="menuu">
                    <li data-format="csv">CSV</li>
                    <li data-format="pdf">PDF</li>
                </ul>
            </div>
            <div class="dropdown">
                <div class="select">
                    <span class="selected">Statistics</span>
                    <div class="caret"></div>
                </div>
                <ul class="menuu">
                    <li>All products</li>
                    <li>Favorites products</li>
                    <li>The most bought products</li>
                </ul>
            </div>
            <button id="downloadBtn">Download</button>
        </ul>
    </div>
    <div class="container">
        <h3 class="headeing">Statistics</h3> 
    </div>

    <script>
		const dropdowns = document.querySelectorAll('.dropdown');

dropdowns.forEach(dropdown => {
    const select = dropdown.querySelector('.select');
    const caret = dropdown.querySelector('.caret');
    const menuu = dropdown.querySelector('.menuu');
    const options = dropdown.querySelectorAll('.menuu li');
    const selected = dropdown.querySelector('.selected');

    select.addEventListener('click', () => {
        select.classList.toggle('select-clicked');
        caret.classList.toggle('caret-rotate');
        menuu.classList.toggle('menu-open');
    });

    options.forEach(option => {
        option.addEventListener('click', () => {
            selected.innerText = option.innerText;
            select.classList.remove('select-clicked');
            caret.classList.remove('caret-rotate');
            menuu.classList.remove('menu-open');
            options.forEach(option => {
                option.classList.remove('active');
            });
            option.classList.add('active');
        });
    });
});

        const downloadBtn = document.getElementById('downloadBtn');
        const selectedFormat = document.querySelector('.selected');
        const statisticsOptions = document.querySelectorAll('.menuu li');

        downloadBtn.addEventListener('click', function() {
            const selectedOption = document.querySelector('.menuu li.active');
            const format = selectedOption.dataset.format;
            const selectedStatistics = document.querySelector('.menuu li.active').innerText
                .toLowerCase()
                .replace(/\s/g, "_");
            let downloadUrl, fileName;

            if (selectedStatistics === "all_products") {
                downloadUrl = `http://localhost:8000/downloadAllProducts-${format}`;
                fileName = `all_products_report.${format}`;
            } else {
                downloadUrl = `http://localhost:8000/download${selectedStatistics}-${format}`;
                fileName = `${selectedStatistics}_report.${format}`;
            }

            fetch(downloadUrl)
                .then(response => {
                    if (response.ok) {
                        return response.blob();
                    } else {
                        throw new Error(`A apărut o eroare la descărcarea fișierului ${format.toUpperCase()}.`);
                    }
                })
                .then(blob => {
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = fileName;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                })
                .catch(error => {
                    console.error(`Eroare la descărcarea fișierului ${format.toUpperCase()}:`, error);
                });
        });

        statisticsOptions.forEach(option => {
            option.addEventListener('click', () => {
                const selectedStatistics = option.innerText.toLowerCase().replace(/\s/g, "_");
                const selectedOption = document.querySelector('.menuu li.active');
                const format = selectedOption.dataset.format;
                let downloadUrl, fileName;

                if (selectedStatistics === "all_products") {
                    downloadUrl = `http://localhost:8000/downloadAllProducts-${format}`;
                    fileName = `all_products_report.${format}`;
                } else {
                    downloadUrl = `http://localhost:8000/download${selectedStatistics}-${format}`;
                    fileName = `${selectedStatistics}_report.${format}`;
                }

                fetch(downloadUrl)
                    .then(response => {
                        if (response.ok) {
                            return response.blob();
                        } else {
                            throw new Error(`A apărut o eroare la descărcarea fișierului ${format.toUpperCase()}.`);
                        }
                    })
                    .then(blob => {
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = fileName;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                    })
                    .catch(error => {
                        console.error(`Eroare la descărcarea fișierului ${format.toUpperCase()}:`, error);
                    });
            });
        });
	</script>
</body>
</html>